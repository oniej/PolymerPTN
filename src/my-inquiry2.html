<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/vaadin-dialog/vaadin-dialog.html">
<link rel="import" href="../bower_components/salte-dialog/salte-dialog.html">
<link rel="import" href="../bower_components/paper-dropdown-input/paper-dropdown-input.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">


<link rel="import" href="time-element.html">
<link rel="import" href="shared-styles.html">
<dom-module id="my-inquiry2">
    <template>
        <style include="shared-styles">
            :host {
                height: 100vh;
                margin: 0;
                display: flex;
                flex-direction: column;
            }
            @media (max-width: 768px) {
                div .availability {
                    margin: 16px;
                    display: flex;
                    flex-direction: column;
                    border-radius: 3px;
                }
                #dateandRoom {
                    display: flex;
                }
            }
            @media (min-width: 768px) {
                div .availability {
                    width: 765px;
                    margin: 16px auto;
                    border-radius: 3px;
                    box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
                }
            }
            #hotels {
                border-collapse: collapse;
                width: 100%;
            }
            /* #hotels tr:nth-child(even) {
                background-color: #f2f2f2;
            } */
            /* #hotels tr:hover {
                border: 1px solid rgb(0, 0, 0);
            }
             */
            #hotels td {
                height: 25px;
                border: 1px solid rgb(100, 100, 100);
            }
            #hotels th {
                text-align: left;
                height: 25.5px;
            }
            .avatar-container-profile {
                position: relative;
                border: 2px solid darkorange;
                border-radius: 50%;
                height: 90px;
                padding: 2px;
                width: 90px;
                margin: 20px auto;
            }
            app-header {
                color: rgb(255, 255, 255);
                background-color: darkorange;
            }
            hr {
                background-color: #eee;
                border: 0 none;
                color: #eee;
                height: 1px;
            }
            .dateclass {
                background-color: #1B5E20;
                color: white;
            }
            .hotel {
                position: absolute;
                width: 14.5em;
                max-width: 14.5em;
                left: 2em;
                border-bottom: 1px solid;
                text-align: left;
            }
            .room {
                position: absolute;
                width: 13.4em;
                max-width: 13.4em;
                left: 16.6em;
                border-bottom: 1px solid;
                text-align: left;
            }
            .detail {
                text-align: center;
                border: 1px solid rgb(100, 100, 100);
            }
            .trdetail:nth-child(even) {
                background-color: #c0c0c0;
            }
            .trdetail:nth-child(odd) {
                background-color: white;
            }
            #hotels td:hover {
                cursor: pointer;
                background-color: navajowhite;
            }
            .detailgreen:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            .detailred:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            detailyellow:hover {
                opacity: 0.5;
                filter: alpha(opacity=100);
                /* For IE8 and earlier */
            }
            .detailgreen {
                text-align: center;
                background: url(/images/colorgreen.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 80% 80%;
                background-position: center;
                color: black;
            }
            .detailred {
                text-align: center;
                background: url(/images/colorred.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 80% 80%;
                background-position: center;
                color: white;
            }
            .detailyellow {
                text-align: center;
                background: url(/images/coloryellow.png);
                opacity: 1.0;
                filter: alpha(opacity=50);
                background-repeat: no-repeat;
                background-size: 80% 80%;
                background-position: center;
                color: white;
            }
            #table {
                overflow: auto;
            }
            .table {
                width: auto;
                margin-left: 27.8em;
                overflow: auto;
            }
            #moreDetails {
                width: 30%;
            }
            paper-dialog {
                background-color: rgb(245, 245, 245);
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
                box-shadow: 0.5px;
            }
            #moreDetails #header {
                background-color: rgb(255, 255, 255);
                height: 30px;
                border-bottom: 1px solid rgb(196, 196, 196);
                padding: 5px;
                padding-top: 15px;
                /* -webkit-border-top-left-radius: 5px;
                -webkit-border-top-right-radius: 5px;
                -moz-border-radius-topleft: 5px;
                -moz-border-radius-topright: 5px;
                border-top-left-radius: 5px;
                border-top-right-radius: 5px; */
            }
            #moreDetails #footer {
                margin-bottom: 0;
                margin-top: 37px;
                background-color: rgb(255, 255, 255);
                border-top: 1px solid rgb(196, 196, 196);
                -webkit-border-bottom-right-radius: 5px;
                -webkit-border-bottom-left-radius: 5px;
                -moz-border-radius-bottomright: 5px;
                -moz-border-radius-bottomleft: 5px;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
            }
        </style>
        <iron-ajax auto url="{{urluser}}" handle-as="json" method="GET" on-response="_userLoaded"></iron-ajax>

        <!-- group -->
        <iron-ajax auto url="{{urlGroup}}" handle-as="json" method="GET" on-response="_groupLoaded"></iron-ajax>
        <iron-ajax auto url="{{urlAgent}}" handle-as="json" method="GET" on-response="_agentLoaded"></iron-ajax>
        <!-- <iron-ajax auto url="{{urlJoin}}" params='{}' handle-as="json" method="GET" on-response="_joinLoaded" loading="{{loadingData}}" debounce-duration="300"></iron-ajax> -->
        <!-- allocation -->
        <iron-ajax id="workspace" url="{{urlFilterworkspace}}" handle-as="json" method="GET" on-response="_urlFilterworkspaceloaded"></iron-ajax>
        <iron-ajax id="startalloc" url="{{urlFilterStart}}" handle-as="json" method="GET" on-response="_urlFilterStartloaded"></iron-ajax>
        <iron-ajax id="endalloc" url="{{urlFilterend}}" handle-as="json" method="GET" on-response="_urlFilterend"></iron-ajax>
        <!-- availability -->
        <iron-ajax id="startavail" url="{{Startavail}}" handle-as="json" method="GET" on-response="_startavailloaded"></iron-ajax>
        <iron-ajax id="endavail" url="{{Endavail}}" handle-as="json" method="GET" on-response="_endavailloaded"></iron-ajax>
        <!-- blockings -->
        <iron-ajax id="startblock" url="{{Startblockings}}" handle-as="json" method="GET" on-response="_startblockloaded"></iron-ajax>
        <iron-ajax id="endblock" url="{{Endblockings}}" handle-as="json" method="GET" on-response="_endblockloaded"></iron-ajax>
        <iron-pages selected="[[route.path]]" attr-for-selected="name" fallback-selection="view404" role="main">
            <div name="">
                <app-header-layout fullbleed has-scrolling-region>
                    <app-header fixed slot="header">
                        <app-toolbar>
                            <paper-icon-button class="menu" icon="my-icons:menu" drawer-toggle on-tap="toggleDrawer"></paper-icon-button>
                            <div main-title>Agent Inquiry</div>
                        </app-toolbar>
                    </app-header>

                    <!-- <iron-ajax auto url="src/sampleData.json" on-response="_handleResponse"></iron-ajax> -->

                    <div class="card">
                        <div style="display: inline;" id="dateandRoom">
                            <div style="display: flex">
                                <div style="display: flex">
                                    <template is="dom-if" if="{{checkRole(role)}}">
                                        <paper-dropdown-input label="Select Group" items='[[groupItems]]' filter-property="group" value="{{group}}">
                                            <template>
                                                <template is="dom-repeat" items="[[items]]" as="item">
                                                    <paper-item>[[item.group]]</paper-item>
                                                </template>
                                            </template>
                                        </paper-dropdown-input>
                                        <paper-dropdown-input style="margin-left: 10px;" label="Select Agent" items='[[agentsload]]' filter-property="code" value="{{code}}">
                                            <template>
                                                <template is="dom-repeat" items="[[items]]" as="item">
                                                    <paper-item label="[[item.code]]">[[item.name]]</paper-item>
                                                </template>
                                            </template>
                                        </paper-dropdown-input>
                                    </template>
                                    <div style="display: flex; margin-left: 20px;">
                                        <paper-input label="Check in" type="date" value="{{checkin}}" max="{{checkout}}">
                                            <iron-icon icon="my-icons:date-range" slot="prefix"></iron-icon>
                                        </paper-input>
                                    </div>
                                    <div style="display: flex; margin-left: 20px;">
                                        <paper-input label="Check out" type="date" value="{{checkout}}" min="{{checkin}}">
                                            <iron-icon icon="my-icons:date-range" slot="prefix"></iron-icon>
                                        </paper-input>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div id="peak">
                            <span style="color: red">Peak Season</span>
                            <span style="color: green;margin-left: 14px;">Open</span>
                            <!-- <span style="color:yellow;margin-left: 14px;">limited</span> -->
                        </div>
                        <div id="table">
                            <span style="float: right">{{start}} {{end}}</span>
                            <br>
                            <div id="errorMsgDiv" style="display: none;">
                                <iron-icon icon="my-icons:error-outline"></iron-icon>&nbsp;{{errorMsg}}</div>
                            <div class="table">
                                <table id="hotels">
                                </table>
                            </div>
                        </div>
                    </div>
                </app-header-layout>
        </iron-pages>
        <paper-dialog id="moreDetails" no-overlap horizontal-align="left" vertical-align="top">
            <div id="header">
                <b style="font-size: 25px; margin-left: 5px;">{{hotel}}</b>
            </div>
            <div>
                <div style="margin-bottom: 5px;">Room Type:
                    <b style="font-size: 20px;"> {{rooms}}</b>
                </div>
                <div style="margin-bottom: 5px;">Room Status:
                    <b style="font-size: 18px;">{{status}}</b>
                </div>
                <div style="margin-bottom: 5px;">Date:
                    <b style="font-size: 18px;">{{cdate}}</b>
                </div>
                <div id="peakseason">Season:
                    <b style="font-size: 18px;">{{season}}</b>
                </div>
            </div>
            <div>
                <div>
                    <b>Room Details</b>
                </div>
                <hr id="alloc" style="background-color: rgb(100, 100, 100)">
                <div id="allocation">
                    <div style="font-size: 20px;">Allocation</div>
                    <div>Room Qty:
                        <b>{{allocation}}</b>
                    </div>
                    <div id="cutoff"> Cut-Off Date:
                        <b>{{cutoffdate}}</b>
                    </div>
                </div>
                <hr id="block" style="background-color: rgb(100, 100, 100)">
                <div id="blocking">
                    <div style="font-size: 20px;">Blocking</div>
                    <div>Room Qty:
                        <b>{{blocking}}</b>
                    </div>
                    <div id="cancellation"> Cancellation Date:
                        <b>{{cancel}}</b>
                    </div>
                </div>
            </div>
            <div id="footer">
                <br>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'my-inquiry2',
            properties: {
                code: String,
                checkin: { type: String, observer: 'checkinChange' },
                checkout: String,
                checkoutMax: String,
                stardate: String,
                enddate: String,
                hotelId: String,
                groupworkspace: Object,
                accountKey: String,
                status: String,
                from: String,
            },
            observers: [
                '_endCheckout(checkout)',
                '_tappedChanged(tapped)',
                '_tappedChangedC(opened)',
                '_createTable(group,checkin,checkout,data)'
            ],
            ready() {
                this.urlGroup = 'group/read';
                this.urluser = '/user/getkey/' + this.accountKey;
                this.urlAgent = '/agent/read';
                var hidePeak = Polymer.dom(this.root).querySelector("#peak").setAttribute("style", "display:none");
                var errormsg = Polymer.dom(this.root).querySelector("#errorMsgDiv").setAttribute("style", "display:none");
                this.errorMsg = "";
                var table = Polymer.dom(this.root).querySelector('#hotels');
                while (table.hasChildNodes()) {
                    table.removeChild(table.lastChild);
                }
                this.start = "";
                this.end = "";
            },
            _userLoaded(data) {
                this.group = data.detail.response.data.group;
                this.agent = data.detail.response.data.agent;
                this.role = data.detail.response.data.role;
            },
            _agentLoaded(data) {
                this.agentsload = data.detail.response.data;
            },
            checkRole(c) {
                if (c === "Admin" || c === "Staff") return true;
                else { }
            },
            checkinChange(e) {
                this.from = e;
                var _maxDate = new Date(e);
                _maxDate.setMonth(_maxDate.getMonth() + 1);
                this.checkoutMax = _maxDate.getFullYear() + "-" + ("0" + (_maxDate.getMonth() + 1)).slice(-2) + "-" + ("0" + (_maxDate.getDate() - 1)).slice(-2)
            },
            _tappedChangedC(f) {
                if (this.$.moreDetails.opened == true) {
                    this.$.moreDetails.opened = false;
                }
            },
            _tappedChanged(e) {
                console.log(e);
                var [hotel, rooms, stat, nonpeak, peak, seasondates, blocking, cancel, pdayscutoff, nonpdayscutoff, currentdate, cutoffdate, ispeak] = e.split("~");
                var newdate = new Date(currentdate);
                newdate.setDate(newdate.getDate() - parseInt(nonpdayscutoff));
                var _currentDateAllocquery = newdate.getFullYear() + "-" + ("0" + (newdate.getMonth() + 1)).slice(-2) + "-" + ("0" + newdate.getDate()).slice(-2);
                var dates = new Date(currentdate);
                dates.setDate(dates.getDate() - parseInt(pdayscutoff));
                var _currentDateAllocquery2 = dates.getFullYear() + "-" + ("0" + (dates.getMonth() + 1)).slice(-2) + "-" + ("0" + dates.getDate()).slice(-2);
                var currentdates = new Date(currentdate);
                var _currentDates = currentdates.getFullYear() + "-" + ("0" + (currentdates.getMonth() + 1)).slice(-2) + "-" + ("0" + currentdates.getDate()).slice(-2);
                // if (e) {
                if (ispeak) {
                    if (blocking != 0) {
                        this.allocation = peak;
                        this.season = seasondates;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.cancel = cancel;
                        this.blocking = blocking;
                        this.cutoffdate = _currentDateAllocquery2;
                        Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                        this.$.moreDetails.opened = true;
                    } else {
                        this.season = seasondates;
                        this.allocation = peak;
                        this.cdate = _currentDates;
                        this.hotel = hotel;
                        this.rooms = rooms;
                        this.status = stat;
                        this.blocking = blocking;
                        this.cutoffdate = _currentDateAllocquery2;
                        Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                        Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                        this.$.moreDetails.opened = true;
                    }
                } else {
                    // if (blocking != 0) {
                    //     this.season = "";
                    //     this.allocation = peak;
                    //     this.cdate = _currentDates;
                    //     this.hotel = hotel;
                    //     this.rooms = rooms;
                    //     this.status = stat;
                    //     this.blocking = blocking;
                    //     this.cutoffdate = _currentDateAllocquery2;
                    //     Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:none");
                    //     Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                    //     Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                    //     this.$.moreDetails.opened = true;
                    // } else {
                    // }
                }
                // if (ispeak === "undefined") {
                //     if (blocking) {
                //         Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:none");
                //         Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                //         Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                //         this.allocation = nonpeak;
                //         this.cdate = currentdate;
                //         this.hotel = hotel;
                //         this.rooms = rooms;
                //         this.status = stat;
                //         this.cancel = cancel;
                //         this.blocking = blocking;
                //         this.cutoffdate = _currentDateAllocquery;
                //     } else {
                //         Polymer.dom(this.root).querySelector("#peakseason").setAttribute("style", "display:none");
                //         Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:none");
                //         Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:none");
                //         this.allocation = nonpeak;
                //         this.cdate = currentdate;
                //         this.hotel = hotel;
                //         this.rooms = rooms;
                //         this.status = stat;
                //         this.cutoffdate = _currentDateAllocquery;
                //     }
                // }
                // if (blocking == 0) {
                //     Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:none");
                //     Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:none");
                //     Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:none");
                // } else {
                //     Polymer.dom(this.root).querySelector("#blocking").setAttribute("style", "display:block");
                //     Polymer.dom(this.root).querySelector("#cancellation").setAttribute("style", "display:block");
                //     Polymer.dom(this.root).querySelector("#block").setAttribute("style", "display:block");
                // }
                // if (this.allocation === "NaN") {
                //     Polymer.dom(this.root).querySelector("#allocation").setAttribute("style", "display:none");
                //     Polymer.dom(this.root).querySelector("#cutoff").setAttribute("style", "display:none");
                //     Polymer.dom(this.root).querySelector("#alloc").setAttribute("style", "display:none");
                // } else {
                //     Polymer.dom(this.root).querySelector("#allocation").setAttribute("style", "display:block");
                //     Polymer.dom(this.root).querySelector("#cutoff").setAttribute("style", "display:block");
                //     Polymer.dom(this.root).querySelector("#alloc").setAttribute("style", "display:block");
                // }
                // } else {
                // }
            },
            _hotelIdChanged(j) {
                this.stardate = this.checkin;
                this.roomSelected = j;
                this.urlFilterworkspace = '/group/filter/' + j;
                this.$.workspace.handleAs = "json";
                this.$.workspace.generateRequest();
            },
            _urlFilterworkspaceloaded(data) {
                this.groupworkspace = data.detail.response.data;
            },
            _endCheckout(f) {
                this.to = f;
                if (f) {
                    if (this.role === "Admin" || this.role === "Staff") {
                        this.urlFilterend = '/allocation/inquirySource2/' + this.from + "_" + this.to + "_" + this.group + "_" + this.code;
                        this.$.endalloc.generateRequest();
                    }
                    else {
                        this.urlFilterend = '/allocation/inquirySource2/' + this.from + "_" + this.to + "_" + this.group + "_" + this.code;
                        this.$.endalloc.generateRequest();
                    }
                }
            },
            _urlFilterend(data) {
                if (data.detail.response.data) {
                    this.data = data.detail.response.data;
                }
            },
            _createTable(group, checkin, checkout, data) {
                var currentGroup = group;
                var startDate = new Date(checkin); //YYYY-MM-DD
                var endDate = new Date(checkout); //YYYY-MM-DD
                var dateArr = getDateArray(startDate, endDate);
                function getDateArray(start, end) {
                    var arr = new Array();
                    var dt = new Date(start);
                    while (dt <= end) {
                        arr.push(new Date(dt));
                        dt.setDate(dt.getDate() + 1);
                    }
                    return arr;
                }
                var myDates = [];
                var myDates2 = [];
                for (var i = 0; i < dateArr.length; i++) {
                    var dates = formatDate(dateArr[i]);
                    myDates.push(dates);
                    myDates2.push(_monthFormat(dates));
                }
                function _monthFormat(e) {
                    var [y, m, d] = e.split("-");
                    if (m < 10) {
                        var finalMonth = m.substring(1, 2) - 1;
                    } else {
                        var finalMonth = m - 1;
                    }
                    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
                    // return monthNames[finalMonth] + "-" + d + "-" + y;
                    return monthNames[finalMonth] + "-" + d;
                }
                function formatDate(date) {
                    var d = new Date(date),
                        month = '' + (d.getMonth() + 1),
                        day = '' + d.getDate(),
                        year = d.getFullYear();
                    if (month.length < 2) month = '0' + month;
                    if (day.length < 2) day = '0' + day;
                    return [year, month, day].join('-');
                }
                if (group && checkin && checkout) {
                    var table = Polymer.dom(this.root).querySelector('#hotels');
                    var tr1 = document.createElement('tr');
                    //delete onchanged sa input date
                    while (table.hasChildNodes()) {
                        table.removeChild(table.lastChild);
                    }
                    //table header
                    var thHotel = document.createElement('th');
                    var hotelName = document.createTextNode("Hotels");
                    thHotel.appendChild(hotelName);
                    thHotel.setAttribute("class", "hotel");
                    thHotel.style.textAlign = "center";
                    tr1.appendChild(thHotel);
                    var thRoom = document.createElement('th');
                    var roomName = document.createTextNode("Rooms");
                    thRoom.appendChild(roomName);
                    thRoom.setAttribute("class", "room");
                    thRoom.style.textAlign = "center";
                    tr1.appendChild(thRoom);
                    for (var y = 0; y < myDates.length; y++) {
                        var thDates = document.createElement('td');
                        var dateHeader = document.createTextNode(myDates2[y]);
                        thDates.appendChild(dateHeader);
                        thDates.setAttribute("class", "detail");
                        tr1.appendChild(thDates);
                    }
                    table.appendChild(tr1);
                    //table header
                    //table td / data
                    if (data) {
                        data.forEach(element => {
                            var tr2 = document.createElement('tr');
                            tr2.setAttribute("class", "trdetail");
                            var tdHotel = document.createElement('th');
                            var hotel = document.createTextNode(element.hotelname);
                            tdHotel.appendChild(hotel);
                            tdHotel.setAttribute("class", "hotel");
                            tr2.appendChild(tdHotel);
                            var tdRoom = document.createElement('th');
                            var room = document.createTextNode(element.roomname);
                            tdRoom.appendChild(room);
                            tdRoom.setAttribute("class", "room");
                            tr2.appendChild(tdRoom);
                            element.dates.forEach(cdate => {
                                if ((cdate.details.availability.length + cdate.details.allocation.length + cdate.details.blocking.length + cdate.details.booking.length) > 0) {
                                    var tdDateData = document.createElement('td');
                                    if (cdate.details.seasondetails.length > 0) {
                                        if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloc = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloc);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)));
                                                tdDateData.appendChild(allocs);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                            if (cdate.details.blocking.length > 0) {
                                                var allocs = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(allocs);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocsa = document.createTextNode(parseInt(cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0));
                                                tdDateData.appendChild(allocsa);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(alloca);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocas = document.createTextNode(parseInt(cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0));
                                                tdDateData.appendChild(allocas);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                    }
                                    else {
                                        if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "green") {
                                            if (cdate.details.blocking.length > 0) {
                                                var allocsaa = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt((cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0)));
                                                tdDateData.appendChild(allocsaa);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocsaaa = document.createTextNode((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0));
                                                tdDateData.appendChild(allocsaaa);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailgreen");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "red") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt(cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0));
                                                tdDateData.appendChild(alloca);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocas = document.createTextNode((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0));
                                                tdDateData.appendChild(allocas);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailred");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                        else if ((cdate.details.availability.length > 0 ? cdate.details.availability[0].classColor : "") === "yellow") {
                                            if (cdate.details.blocking.length > 0) {
                                                var alloca = document.createTextNode(parseInt((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0)) + parseInt(cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0));
                                                tdDateData.appendChild(alloca);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            } else {
                                                var allocas = document.createTextNode((cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0));
                                                tdDateData.appendChild(allocas);
                                                tdDateData.style.textAlign = "center";
                                                tdDateData.setAttribute("class", "detailyellow");
                                                tdDateData.style.color = "white";
                                                tr2.appendChild(tdDateData);
                                            }
                                        }
                                    }
                                    tdDateData.setAttribute('id', element.hotelname + "~" + element.roomname + "~" + (cdate.details.availability.length > 0 ? cdate.details.availability[0].status : "No Update") + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_qty : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_qty : 0) + "~" + (cdate.details.seasondetails.length > 0 ? cdate.details.seasondetails[0].season : "") + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].block : 0) + "~" + (cdate.details.blocking.length > 0 ? cdate.details.blocking[0].cancel : null) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].pk_coff : 0) + "~" + (cdate.details.allocation.length > 0 ? cdate.details.allocation[0].npk_coff : 0) + "~" + cdate.date + "~" + "" + "~" + (cdate.details.seasondetails.length > 0 ? true : false));
                                    var self = this;
                                    tdDateData.addEventListener('mouseover', function (e) {
                                        self.tapped = e.target.id;
                                    });
                                    tdDateData.addEventListener('mouseout', function (f) {
                                        self.opened = f.target.id;
                                    });
                                }
                                else {
                                    var tdDateData = document.createElement('td');
                                    var alloc = document.createTextNode(" ");
                                    tdDateData.appendChild(alloc);
                                    tr2.appendChild(tdDateData);
                                    tdDateData.setAttribute('id', element.hotelname + "~" + element.roomname + "~" + "No update" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "" + "~" + "");
                                    var self = this;
                                    tdDateData.addEventListener('mouseover', function (e) {
                                        self.tapped = e.target.id;
                                    });
                                    tdDateData.addEventListener('mouseout', function (f) {
                                        self.opened = f.target.id;
                                    });
                                }
                            });
                            table.appendChild(tr2);
                        });
                    }
                }
            },
            _groupLoaded(data) {
                this.groupItems = data.detail.response.data;
            },
            toggleDrawer() {
                this.dispatchEvent(new CustomEvent('toggleDrawer', {
                    bubbles: true, composed: true, detail: {
                        narrow: this.$.narrow
                    }
                }));
                this.$.narrow = !this.$.narrow;
            },
        });
    </script>
</dom-module>